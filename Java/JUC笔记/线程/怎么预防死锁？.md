# 怎么预防死锁？

预防死锁的方式就是打破四个必要条件中的任意一个即可。

* 打破互斥条件：在系统里取消互斥。若资源不被一个进程独占使用，那么死锁是肯定不会发生的。但一般来说在所列的四个条件中，“互斥”条件是无法破坏的。因此，在死锁预防里主要是破坏其他几个必要条件，而不去涉及破坏“互斥”条件。

* 打破请求和保持条件：

  * 采用资源预先分配策略，即进程运行前申请全部资源，满足则运行，不然就等待。
  * 每个进程提出新的资源申请前，必须先释放它先前所占有的资源。

* 打破不可剥夺条件：当进程占有某些资源后又进一步申请其他资源而无法满足，则该进程必须释放它原来占有的资源。

* 打破环路等待条件：实现资源有序分配策略，将系统的所有资源统一编号，所有进程只能采用按序号递增的形式申请资源。

尽量使用 `tryLock(long timeout, TimeUnit unit)`​ 的方法 `(ReentrantLock、ReentrantReadWriteLock)`​，设置超时时间，超时可以退出防止死锁。  
尽量使用 `Java.util.concurrent`​ 并发类代替自己手写锁。  
尽量降低锁的使用粒度，尽量不要几个功能用同一把锁。  
尽量减少同步的代码块。

‍
